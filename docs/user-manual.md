# ユーザーマニュアル

## 概要

株主対話デモアプリケーションの詳細な利用方法について説明します。本アプリケーションは、Azure OpenAI を活用して株主総会での対話をシミュレートし、企業の決算資料や株主総会資料を基にした自然な質疑応答を生成します。

## 🚀 開始前の準備

### 必要なもの

1. **Azure OpenAI アクセス**: 有効な Azure OpenAI サブスクリプション
2. **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
3. **PDF ファイル**: 決算短信、株主総会資料、有価証券報告書など

### Azure OpenAI 情報の準備

以下の情報を Azure ポータルで事前に確認してください：

- **エンドポイント URL**: `https://your-resource.openai.azure.com/`
- **API キー**: リソースの「キーとエンドポイント」画面で確認
- **デプロイメント名**: 作成したGPTモデルのデプロイ名
- **API バージョン**: `2024-02-15-preview` (推奨)

## 📖 基本的な使用手順

### ステップ 1: アプリケーションの起動

1. **ファイルを開く**
   ```
   src/index.html をブラウザで開く
   ```
   または
   ```bash
   # Webサーバーを起動する場合
   cd src
   python -m http.server 8000
   # ブラウザで http://localhost:8000 を開く
   ```

2. **画面構成の確認**
   - 上部: Azure OpenAI 接続設定エリア
   - 左側: PDF資料管理エリア
   - 右側: 対話シミュレーションエリア

### ステップ 2: Azure OpenAI の接続設定

1. **言語選択**
   - 「対話言語」ドロップダウンから希望する言語を選択
   - 選択可能言語: 日本語、English、中文、Deutsch、Français、Español、한국어

2. **接続情報の入力**
   - **エンドポイント URL**: Azure リソースのエンドポイントを入力
   - **API キー**: 32文字のAPIキーを入力
   - **デプロイメント名**: GPT-4モデルのデプロイ名を入力
   - **API バージョン**: `2024-02-15-preview` を入力

3. **接続テスト**
   - 「🔗 接続テスト」ボタンをクリック
   - 「接続テスト成功」メッセージを確認

4. **設定保存**
   - 「💾 設定保存」ボタンで設定をローカルに保存
   - 次回起動時に自動的に設定が復元されます

> **💡 ヒント**: 接続テスト成功後、設定エリアは自動的に折り畳まれます

### ステップ 3: PDF資料のアップロード

1. **ファイル選択**
   - 「📄 PDF資料アップロード」セクションの「ファイルを選択」をクリック
   - 決算短信、株主総会資料、有価証券報告書などのPDFファイルを選択
   - 複数ファイルの同時選択が可能です

2. **ファイル確認**
   - アップロードしたファイルが一覧に表示されます
   - ファイル名、ファイルサイズ、アップロード時刻が表示されます

3. **プレビュー表示**
   - ファイル一覧の「👁️ プレビュー」ボタンをクリック
   - PDFの内容がプレビューエリアに表示されます
   - 「⬅️ 前のページ」「次のページ ➡️」でページ移動が可能

> **📝 注意**: PDF処理はブラウザ内で完結し、外部に送信されません

### ステップ 4: 対話シミュレーションの実行

1. **対話開始**
   - 「🚀 対話開始」ボタンをクリック
   - システムメッセージで対話開始が通知されます

2. **自動対話進行**
   - **ターン1**: 株主からの最初の質問が自動生成されます
   - **ターン1**: 取締役からの回答が自動生成されます
   - **ターン2-5**: 同様に5ターンまで自動的に進行します

3. **対話内容の確認**
   - 株主の発言: 青色の吹き出し（👤 アイコン）
   - 取締役の発言: 緑色の吹き出し（👔 アイコン）
   - システムメッセージ: 紫色の吹き出し（📋 アイコン）

4. **対話要約**
   - 5ターン完了後、対話内容の要約が自動生成されます
   - 要約は自動的にポップアップで表示されます

### ステップ 5: 詳細表示とナビゲーション

1. **吹き出しの詳細表示**
   - 任意の吹き出しをクリックすると、内容が拡大表示されます
   - マークダウン形式の装飾が適用されます

2. **モーダルの操作**
   - **閉じる方法**:
     - ヘッダーの ❌ ボタンをクリック
     - フッターの「閉じる」ボタンをクリック
     - ESC キーを押す
     - 背景部分をクリック

3. **対話のクリア**
   - 「🗑️ 対話クリア」ボタンで対話履歴をリセット
   - 新しい対話を開始できます

## 🎯 効果的な使用方法

### PDF資料の選択コツ

**推奨する資料**:
- 決算短信（業績ハイライト）
- 株主総会招集通知
- 有価証券報告書（主要部分）
- 中期経営計画書
- ESG/サステナビリティレポート

**ファイルサイズの目安**:
- 1ファイルあたり: 10MB以下
- 総ページ数: 50ページ以下
- テキスト中心の資料が効果的

### 質の高い対話を生成するために

1. **資料の質**
   - 最新の決算資料を使用
   - 具体的な数値データを含む資料
   - 戦略や展望が記載された資料

2. **言語選択**
   - 資料の言語と対話言語を一致させる
   - 日本企業の資料には日本語を推奨

3. **複数資料の活用**
   - 異なる種類の資料を組み合わせる
   - 時系列での変化が分かる資料

## 🔧 設定とカスタマイズ

### 言語設定の変更

1. **対話中の言語変更**
   - 対話言語ドロップダウンから別の言語を選択
   - 次回の対話開始時から新しい言語が適用されます

2. **言語ごとの特徴**
   - **日本語**: 敬語を使った丁寧な表現
   - **English**: フォーマルなビジネス英語
   - **中文**: 简体中文での表現
   - その他の言語: それぞれの文化に適した表現

### UI設定の調整

1. **設定パネルの折り畳み**
   - 設定ヘッダーの矢印ボタンをクリック
   - 対話エリアを広く使用できます

2. **レスポンシブ表示**
   - ブラウザウィンドウサイズに応じて自動調整
   - モバイルデバイスでも快適に利用可能

## ❗ トラブルシューティング

### よくある問題と解決方法

#### 🔐 接続エラー

**症状**: 「接続テスト」ボタンでエラーが発生
**原因**: 
- APIキーが間違っている
- エンドポイントURLが正しくない
- Azure OpenAIリソースが無効

**解決方法**:
1. Azure ポータルで正しい情報を再確認
2. APIキーをコピー&ペーストで再入力
3. エンドポイントURLの最後に余分な文字がないか確認

#### 📄 PDFが読み込めない

**症状**: PDFアップロード後にプレビューが表示されない
**原因**:
- PDFファイルが破損している
- パスワード保護されたPDF
- ファイルサイズが大きすぎる

**解決方法**:
1. 別のPDFファイルで試す
2. パスワード保護を解除してから再アップロード
3. ファイルサイズを10MB以下に調整

#### 🤖 対話が生成されない

**症状**: 「対話開始」ボタンを押しても質問が生成されない
**原因**:
- Azure OpenAI の接続が不安定
- PDFコンテンツが空または不適切
- API制限に達している

**解決方法**:
1. 接続テストを再実行
2. PDFファイルを再アップロード
3. しばらく時間を置いてから再試行

#### 🌐 生成される言語が違う

**症状**: 日本語を選択したのに英語で回答される
**原因**:
- プロンプトの言語指定が不十分
- Azure OpenAI モデルの言語設定

**解決方法**:
1. 対話言語設定を再確認
2. 「対話クリア」後に新しい対話を開始
3. より明確な日本語のPDF資料を使用

### エラーメッセージ一覧

| エラーメッセージ | 意味 | 対処法 |
|-----------------|------|--------|
| `Unauthorized (401)` | APIキーが無効 | 正しいAPIキーを入力 |
| `Too Many Requests (429)` | リクエスト制限 | 少し待ってから再試行 |
| `Content filtered` | コンテンツフィルター | より中立的な内容の資料を使用 |
| `Context length exceeded` | プロンプトが長すぎる | PDFファイルサイズを縮小 |
| `PDF processing failed` | PDF処理エラー | 別のPDFファイルを試す |

## 💡 活用シナリオ

### 1. IR担当者の事前準備

**目的**: 株主総会での想定質問の洗い出し
**使用手順**:
1. 最新の決算短信をアップロード
2. 日本語で対話シミュレーションを実行
3. 生成された質問を参考に回答を準備

### 2. 投資家の企業分析

**目的**: 企業への質問項目の検討
**使用手順**:
1. 有価証券報告書をアップロード
2. 関心のある言語で対話を生成
3. 投資判断の参考情報として活用

### 3. 学習・研究目的

**目的**: 株主総会の対話パターンの学習
**使用手順**:
1. 複数企業の決算資料をアップロード
2. 異なる言語での対話を比較
3. 業界特有の質問傾向を分析

### 4. 多言語対応の確認

**目的**: グローバル企業の多言語IR対応
**使用手順**:
1. 英語版の決算資料をアップロード
2. 各言語で対話を生成
3. 言語別の質問傾向を比較分析

## 🔒 セキュリティとプライバシー

### データの取り扱い

**保存されるデータ**:
- Azure OpenAI接続設定（ローカルストレージ）
- 選択された言語設定（ローカルストレージ）
- UI表示設定（ローカルストレージ）

**保存されないデータ**:
- アップロードしたPDFファイル
- 生成された対話内容
- PDFから抽出されたテキスト

### プライバシー保護

1. **ローカル処理**: PDFファイルはブラウザ内でのみ処理
2. **セッション限定**: 対話履歴はブラウザ終了時に消去
3. **暗号化通信**: Azure OpenAI との通信はHTTPS で暗号化

### セキュリティのベストプラクティス

1. **APIキー管理**:
   - 定期的なAPIキーのローテーション
   - 不要になった設定のクリア

2. **ファイル管理**:
   - 機密性の高いファイルは使用後に削除
   - パスワード保護されたPDFの使用推奨

3. **ブラウザ設定**:
   - プライベートブラウジングモードの活用
   - セッション終了時のキャッシュクリア

## 📞 サポート

### 技術的な問題

- **GitHub Issues**: [問題報告](https://github.com/tokawa-ms/20250725-kabunushi-demo-001/issues)
- **技術ドキュメント**: [docs/](./README.md) ディレクトリ

### Azure OpenAI 関連

- **Azure サポート**: [Azure ポータル](https://portal.azure.com) のサポートセンター
- **公式ドキュメント**: [Azure OpenAI Service](https://docs.microsoft.com/azure/cognitive-services/openai/)

### その他のお問い合わせ

- **GitHub Discussions**: [ディスカッション](https://github.com/tokawa-ms/20250725-kabunushi-demo-001/discussions)

## 📚 関連リソース

### 参考資料

- [Azure OpenAI Service 概要](https://azure.microsoft.com/services/cognitive-services/openai-service/)
- [GPT-4 技術仕様](https://docs.microsoft.com/azure/cognitive-services/openai/concepts/models)
- [株主総会実務ガイド](https://www.jpx.co.jp/rules-participants/participant-administration/shareholders-meeting/)

### 学習コンテンツ

- [IR活動基礎知識](https://www.jpx.co.jp/listing/ir-support/)
- [決算書の読み方](https://www.fsa.go.jp/ordinary/disclosure/)
- [コーポレートガバナンス](https://www.jpx.co.jp/equities/listing/cg/)

---

## 付録: キーボードショートカット

| ショートカット | 機能 |
|---------------|------|
| `Escape` | モーダルを閉じる |
| `Tab` | フォーカス移動 |
| `Enter` | ボタン実行 |
| `Space` | ボタン実行（フォーカス時） |

## 付録: サポートされるPDFファイル形式

| 形式 | サポート状況 | 備考 |
|------|-------------|------|
| PDF 1.4以降 | ✅ フルサポート | 推奨形式 |
| パスワード保護PDF | ❌ 非対応 | 保護解除後に使用 |
| スキャン画像PDF | ⚠️ 部分対応 | テキスト抽出に制限 |
| フォーム入力PDF | ✅ サポート | フィールド値も抽出 |